<div class="main" id="main">
    <div class="bg-transparent">
        <p-breadcrumb class="w-100" [model]="items" [style]="{'background': 'transparent'}">
            <ng-template #item let-item>
                <ng-container *ngIf="item.route; else elseBlock">
                    <a [routerLink]="item.route" class="p-breadcrumb-item-link">
                        <i [ngClass]="[item.icon ? item.icon : '']"></i>
                        <span class="text-success font-semibold" style="font-size: 14px">{{ item.label }}</span>
                    </a>
                </ng-container>
                <ng-template #elseBlock>
                    <a [href]="item.url">
                        <span style="font-size: 14px; color: #6c757d">{{ item.label }}</span>
                    </a>
                </ng-template>
            </ng-template>
        </p-breadcrumb>
    </div>
    <div class="products-section">
        <p-toast />
        <p-toolbar class="mb-6">
            <ng-template #start>
                <p-button label="Thêm mới" class="me-2" (onClick)="navigateNewLessonPage()"
                    [style]="{'font-size': '14px'}">
                    <i class="pi pi-plus" style="font-size: 14px"></i>
                </p-button>
                <p-button severity="danger" label="Xóa" outlined (onClick)="deleteSelectedLessons()"
                    [disabled]="!selectedLessons || !selectedLessons.length" [style]="{'font-size': '14px'}">
                    <i class="pi pi-trash" style="font-size: 14px"></i>
                </p-button>
            </ng-template>

            <ng-template #end>
                <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Nhập file"
                    chooseLabel="Nhập file" auto customUpload class="me-2 d-inline-block"
                    [chooseButtonProps]="{ severity: 'secondary' }" [style]="{'font-size': '14px'}" />
                <p-button label="Xuất file" severity="secondary" (onClick)="exportCSV($event)"
                    [style]="{'font-size': '14px'}">
                    <i class="pi pi-upload"></i>
                </p-button>
            </ng-template>
        </p-toolbar>

        <p-table #dt [value]="lessons" [rows]="10" [columns]="cols" [paginator]="false"
            [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
            [tableStyle]="{ 'min-width': '75rem' }" [(selection)]="selectedLessons" [rowHover]="true" dataKey="id"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [showCurrentPageReport]="true">
            <ng-template #caption>
                <div class="d-flex align-items-center justify-content-between">
                    <div class="m-0 fs-6 fw-bold">Quản lý bài học</div>
                    <p-iconfield>
                        <p-inputicon class="pi pi-search" />
                        <input class="search-box" pInputText type="text" (input)="onGlobalFilter($event)"
                            placeholder="Tìm kiếm..." />
                    </p-iconfield>
                </div>
            </ng-template>
            <ng-template #header>
                <tr>
                    <th style="width: 3rem">
                        <p-tableHeaderCheckbox />
                    </th>
                    <th style="min-width: 2rem">STT</th>
                    <th style="min-width: 5rem">Audio</th>
                    <th pSortableColumn="name" style="min-width: 12rem">
                        Tiêu đề(Tiếng Hán)
                        <p-sortIcon field="name" />
                    </th>
                    <th pSortableColumn="price" style="min-width: 12rem">
                        Tiêu đề(Tiếng Việt)
                        <p-sortIcon field="price" />
                    </th>
                    <th pSortableColumn="category" style="min-width: 8rem">
                        Cấp dộ
                        <p-sortIcon field="category" />
                    </th>
                    <th pSortableColumn="rating" style="min-width: 8rem">
                        Số câu hỏi
                        <p-sortIcon field="rating" />
                    </th>
                    <th pSortableColumn="inventoryStatus" style="min-width: 8rem">
                        Thời lượng
                        <p-sortIcon field="inventoryStatus" />
                    </th>
                    <th style="min-width: 12rem"></th>
                </tr>
            </ng-template>
            <ng-template #body let-lesson>
                <tr>
                    <td style="width: 3rem">
                        <p-tableCheckbox [value]="lesson" />
                    </td>
                    <td style="min-width: 4rem">{{ lesson.displayOrder }}</td>
                    <td style="min-width: 4rem">
                        <audio [src]="lesson.audioFilePath"></audio>
                        <button class="play-button">
                            <i class="fas" [ngClass]="isPlaying ? 'fa-pause' : 'fa-play'"></i>
                        </button>
                    </td>
                    <td style="min-width: 4rem;">
                        {{ lesson.titleChinese }}
                    </td>
                    <td>
                        {{ lesson.titleVietnamese }}
                    </td>
                    <td>
                        <span [ngClass]="{
                            'level-hsk1-2': lesson.level === 'HSK1' || lesson.level === 'HSK2',
                            'level-hsk3-4': lesson.level === 'HSK3' || lesson.level === 'HSK4',
                            'level-hsk5-6': lesson.level === 'HSK5' || lesson.level === 'HSK6',
                            'level-hsk7-8': lesson.level === 'HSK7' || lesson.level === 'HSK8',
                            'level-hsk9': lesson.level === 'HSK9'
                        }">
                            {{ lesson.level }}
                        </span>
                    </td>

                    <td>
                        {{ lesson.totalSentences }}
                    </td>
                    <td>
                        {{ lesson.estimatedDurationSeconds }} giây
                    </td>
                    <td>
                        <p-button class="me-2" icon="pi pi-pencil" [rounded]="true" [outlined]="true"
                            (click)="editLesson(lesson.id)">
                            <i class="pi pi-pencil"></i>
                        </p-button>
                        <p-button class="me-2" severity="info" icon="pi pi-eye" [rounded]="true" [outlined]="true">
                            <i class="pi pi-eye"></i>
                        </p-button>
                        <p-button severity="danger" icon="pi pi-trash" [rounded]="true" [outlined]="true"
                            (click)="deleteLesson(lesson)">
                            <i class="pi pi-trash"></i>
                        </p-button>

                    </td>
                </tr>
            </ng-template>
        </p-table>

        <div class="d-flex align-items-center justify-content-center">
            <p-paginator (onPageChange)="onPageChange($event)" [first]="first" [rows]="rows"
                [totalRecords]="totalRecords" [rowsPerPageOptions]="[10, 20, 30]" />
        </div>
    </div>
</div>

<p-dialog header="Thông tin bái học" [modal]="true" [(visible)]="visibleLessonDialog" [style]="{ width: '70rem' }"
    [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" class="lesson-dialog">
    <div class="row">
        <div class="col-4 mb-3 mt-3 d-flex">
            <audio *ngIf="lesson" [src]="lesson.audioFilePath" ></audio>
            <button class="play-button me-2">
                <i class="fas" [ngClass]="isPlaying ? 'fa-pause' : 'fa-play'"></i>
            </button>
            <p-fileupload #fu mode="basic" chooseLabel="Choose" chooseIcon="pi pi-upload" name="demo[]"
                url="https://www.primefaces.org/cdn/api/upload.php" accept="audio/*" maxFileSize="10000000"
                (onUpload)="onUpload($event)"/>
        </div>
        <div class="col-4 mb-3 mt-3">
            <p-floatlabel variant="on">
                <input pInputText id="on_label" [(ngModel)]="value2" autocomplete="off" />
                <label for="on_label">Tiêu đề (Tiếng Hán)</label>
            </p-floatlabel>
        </div>
        <div class="col-4 mb-3 mt-3">
            <p-floatlabel variant="on">
                <input pInputText id="on_label" [(ngModel)]="value2" autocomplete="off" />
                <label for="on_label">Tiêu đề (Tiếng Hán)</label>
            </p-floatlabel>
        </div>
        <div class="col-4">
            <p-floatlabel variant="on">
                <input pInputText id="on_label" [(ngModel)]="value2" autocomplete="off" />
                <label for="on_label">Tiêu đề (Tiếng Hán)</label>
            </p-floatlabel>
        </div>
        <div class="col-4">
            <p-floatlabel variant="on">
                <input pInputText id="on_label" [(ngModel)]="value2" autocomplete="off" />
                <label for="on_label">Tiêu đề (Tiếng Việt)</label>
            </p-floatlabel>
        </div>
        <div class="col-4">
            <p-floatlabel class="w-full md:w-56" variant="on">
                <p-select [options]="levels" [(ngModel)]="selectedLevel" [checkmark]="true" [showClear]="true"
                    class="w-100 p-1" />
                <label for="on_label">Tiêu đề (Tiếng Việt)</label>
            </p-floatlabel>
        </div>
    </div>
    <hr>
    <table class="w-100">
        <thead>
            <tr>
                <th style="width: 5%;">ID</th>
                <th style="width: 20%;">Tiếng trung</th>
                <th style="width: 20%;">Pinyin</th>
                <th style="width: 35%;">Tiếng việt</th>
                <th style="width: 10%;">Bắt đầu</th>
                <th style="width: 10%;">Kết thúc</th>
            </tr>
        </thead>
        <tbody *ngIf="lesson">
            @for (sentence of lesson.sentences; track sentence.id) {
            <tr class="mt-3">
                <td>
                    {{ sentence.id }}
                </td>
                <td>
                    <input type="text" [value]="sentence.chineseText" autocomplete="off" />
                </td>
                <td>
                    <input type="text" [value]="sentence.pinyinText" autocomplete="off" />
                </td>
                <td>
                    <input type="text" [value]="sentence.vietnameseTranslation" autocomplete="off" />
                </td>
                <td>
                    <input type="number" [value]="sentence.startTimeSeconds" autocomplete="off" />
                </td>
                <td>
                    <input type="number" [value]="sentence.endTimeSeconds" autocomplete="off" />
                </td>
            </tr>
            }
        </tbody>
    </table>
</p-dialog>