<div class="main" id="main">
  <div class="bg-transparent">
    <p-breadcrumb class="w-100" [model]="items" [style]="{'background': 'transparent'}">
      <ng-template #item let-item>
        <ng-container *ngIf="item.route; else elseBlock">
          <a [routerLink]="item.route" class="p-breadcrumb-item-link">
            <i [ngClass]="[item.icon ? item.icon : '']"></i>
            <span class="text-success font-semibold" style="font-size: 14px">{{ item.label }}</span>
          </a>
        </ng-container>
        <ng-template #elseBlock>
          <a [href]="item.url">
            <span style="font-size: 14px; color: #6c757d">{{ item.label }}</span>
          </a>
        </ng-template>
      </ng-template>
    </p-breadcrumb>
  </div>
  <div class="form-section">
    <div class="row">
      <div class="fs-6 fw-bold mb-4">Thêm bài học mới</div>
      <div class="col-8">
        <p-table [value]="lesson.sentences">
          <ng-template #header>
            <tr>
              <th style="width: 20%;">Tiếng hán</th>
              <th style="width: 20%;">Pinyin</th>
              <th style="width: 33%;">Tiếng việt</th>
              <th style="width: 11%;">Bắt đầu</th>
              <th style="width: 12%;">Kết thúc</th>
              <th style="width: 5%;">Xóa</th>
            </tr> 
          </ng-template>
          <ng-template #body let-sentence>
            <tr>
              <td>{{ sentence.chineseText }}</td>
              <td>{{ sentence.pinyinText }}</td>
              <td>{{ sentence.vietnameseTranslation }}</td>
              <td>{{ sentence.startTimeSeconds }}</td>
              <td>{{ sentence.endTimeSeconds }}</td>
              <td>
                <p-button severity="danger" icon="pi pi-trash" [rounded]="true" [outlined]="true"
                  (click)="deleteSentence(sentence.sentenceOrder)">
                  <i class="pi pi-trash"></i>
                </p-button>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <div>
          <p-button class="me-2" label="Xóa hêt câu hỏi" icon="pi pi-check" variant="outlined" severity="danger"
            [style]="{'width': '48%', 'font-size': '14px'}" (onClick)="deleteAllSentence()">
            <i class="pi pi-trash"></i>
          </p-button>
          <p-button label="Thêm câu hỏi mới" icon="pi pi-check" (onClick)="addNewSentence()"
            [style]="{'width': '48%', 'font-size': '14px'}">
            <i class="pi pi-plus"></i>
          </p-button>
        </div>
      </div>
      <div class="col-4">
        <div class="child-section mb-4">
          <div class="fw-bold pb-4">Thông tin cơ bản</div>
          <div class="pb-4">
            <p-floatlabel class="w-full md:w-56" variant="on">
              <p-select [options]="categories" [(ngModel)]="lesson.categoryId" [checkmark]="true" [showClear]="true"
                class="w-100 p-1" optionLabel="name" optionValue="id" />
              <label for="on_label">Danh mục</label>
            </p-floatlabel>
          </div>
          <div class="pb-4">
            <p-floatlabel class="w-full md:w-56" variant="on">
              <p-select [options]="levels" [(ngModel)]="lesson.level" [checkmark]="true" [showClear]="true"
                class="w-100 p-1" />
              <label for="on_label">Cấp độ</label>
            </p-floatlabel>
          </div>
          <div class="pb-4">
            <p-float-label variant="on">
              <input id="author" class="w-100" pInputText [(ngModel)]="lesson.titleChinese">
              <label for="author">Tiêu đề (Tiếng Hán)</label>
            </p-float-label>
          </div>
          <div class="pb-4">
            <p-float-label variant="on">
              <input id="publisher" class="w-100" pInputText [(ngModel)]="lesson.titleVietnamese">
              <label for="publisher">Tiêu đề (Tiếng việt)</label>
            </p-float-label>
          </div>
          <div class="pb-4">
            <p-float-label variant="on">
              <input id="language" class="w-100" pInputText [(ngModel)]="lesson.estimatedDurationSeconds">
              <label for="language">Tổng thời gian</label>
            </p-float-label>
          </div>
          <div class="pb-4">
            <p-float-label variant="on">
              <input pInputText id="quantity" class="w-100" [(ngModel)]="lesson.totalSentences">
              <label for="quantity">Số câu hỏi</label>
            </p-float-label>
          </div>
          <div class="pb-4">
            <p-float-label variant="on">
              <textarea pTextarea id="description" autocomplete="off" [(ngModel)]="lesson.description"
                style="width: 100%; height: 100px;"></textarea>
              <label for="description">Mô tả</label>
            </p-float-label>
          </div>
          <div>
            <p-fileUpload #fu mode="basic" chooseLabel="Chọn file audio" chooseIcon="pi pi-upload" name="demo" accept="audio/*"
              [maxFileSize]="10000000" [multiple]="false" (onSelect)="onFileSelect($event)" />
          </div>
        </div>
        <div>
          <p-button class="me-2" label="Hủy" icon="pi pi-check" variant="outlined" severity="danger"
            [style]="{'width': '48%', 'font-size': '14px'}">
            <i class="pi pi-times"></i>
          </p-button>
          <p-button label="Lưu" icon="pi pi-check" [loading]="loading" (onClick)="load()"
            [style]="{'width': '48%', 'font-size': '14px'}">
            <i class="pi pi-check"></i>
          </p-button>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog header="Thông tin câu hỏi" [modal]="true" [(visible)]="visibleSentenceDialog" [style]="{ width: '30rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" class="lesson-dialog">
  <div class="mb-3 mt-3">
    <p-floatlabel variant="on">
      <input pInputText id="on_label" [(ngModel)]="newSentence.chineseText" autocomplete="off" />
      <label for="on_label">Tiếng Hán</label>
    </p-floatlabel>
  </div>
  <div class="mb-3 mt-3">
    <p-floatlabel variant="on">
      <input pInputText id="on_label" [(ngModel)]="newSentence.pinyinText" autocomplete="off" />
      <label for="on_label">Pinyin</label>
    </p-floatlabel>
  </div>
  <div class="mb-3 mt-3">
    <p-floatlabel variant="on">
      <input pInputText id="on_label" [(ngModel)]="newSentence.vietnameseTranslation" autocomplete="off" />
      <label for="on_label">Tiếng Việt</label>
    </p-floatlabel>
  </div>
  <div class="row">
    <div class="col-6">
      <p-floatlabel variant="on">
        <p-inputnumber inputId="integeronly" [(ngModel)]="newSentence.startTimeSeconds" id="on_label" />
        <label for="on_label">Bắt đầu (giây)</label>
      </p-floatlabel>
    </div>
    <div class="col-6">
      <p-floatlabel variant="on">
        <p-inputnumber inputId="integeronly" [(ngModel)]="newSentence.endTimeSeconds" id="on_label" />
        <label for="on_label">Kết thúc (giây)</label>
      </p-floatlabel>
    </div>
    <p-button label="Lưu" icon="pi pi-check" [loading]="loading" (onClick)="confirmAddNewSentence()"
      [style]="{'width': '100%', 'font-size': '14px', 'margin-top': '10px'}">
      <i class="pi pi-check"></i>
    </p-button>
  </div>

</p-dialog>